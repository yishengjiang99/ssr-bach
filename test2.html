<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Mocha</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/mocha/8.3.2/mocha.css"
      integrity="sha512-Ytt2foRGKdIInPXwyS3gxRvfTv4n2wi7uB7neCLH1LjExT+PKBeQu6LNVB4QpHaJqx7m2btagBs4kqxYC1QNFg=="
      crossorigin="anonymous"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chai/4.3.4/chai.min.js"></script>
  </head>
  <body>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/mocha/8.3.2/mocha.min.js"
      integrity="sha512-TfAL33PtGUxii1awTCbr3qbzQT5fYi7ItCGUfzWlnMJ4cK5BA8JNY4gJzEs+tQVbyElVbtcI2Jlaf9EFVMvyeg=="
      crossorigin="anonymous"
    ></script>
    <pre></pre>

    <div id="mocha"></div>

    <script>
      mocha.setup('bdd');
    </script>
    <script src="dist/ghettoreact.js"></script>
    <script type="module">
      const pre = document.querySelector('pre');
      import { initsfbk } from './dist/sfbk.js';
      import { Runtime } from './dist/runtime.js';

      const expect = chai.expect;
      describe('mocha', () => {
        it('it tests stuff', () => {
          chai.expect(true);
        });
      });
      describe('aba', () => {
        it('reads ab iterables', async () => {
          initsfbk('https://www.grepawk.com/ssr-bach/GeneralUserGS.sf2').then(
            async ({ pdta: { findPreset }, worker }) => {
              findPreset(0, 0, 55, 55).zones[0].map((z) => {
                worker.postMessage({
                  zone: z.serialize(),
                  note: { key: 55, velocity: 55 },
                  delay: 100,
                });
              });
            }
          );
        });
      });

      describe.skip('init sfbk', () => {
        it('makes 3 fetch calls with ranges for header,sdta, pdta', async () => {
          const sfbk = await initsfbk('file.sf2');
          expect(sfbk.pdta).to.exist;
          return sfbk.sdta.then((res) => {
            expect(res.render).to.exist;
          });
        });
      });

      describe('renderctx', () => {
        it('afa', (done) => {
          import('./dist/worker.js');
        }).timeout(51554);
      });
      mocha.run();
    </script>
    <script type="module" src="test3.js"></script>
  </body>
</html>
