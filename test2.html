<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Mocha</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/mocha/8.3.2/mocha.css"
      integrity="sha512-Ytt2foRGKdIInPXwyS3gxRvfTv4n2wi7uB7neCLH1LjExT+PKBeQu6LNVB4QpHaJqx7m2btagBs4kqxYC1QNFg=="
      crossorigin="anonymous"
    />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/chai/4.3.4/chai.min.js"></script>
  </head>
  <body>
    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/mocha/8.3.2/mocha.min.js"
      integrity="sha512-TfAL33PtGUxii1awTCbr3qbzQT5fYi7ItCGUfzWlnMJ4cK5BA8JNY4gJzEs+tQVbyElVbtcI2Jlaf9EFVMvyeg=="
      crossorigin="anonymous"
    ></script>
    <pre></pre>

    <div id="mocha"></div>

    <script>
      mocha.setup('bdd');
    </script>
    <script src="./lib/react-light.js"></script>
    <script></script>
    <script type="module">
      const pre = document.querySelector('pre');
      import { initsfbk } from './dist/sfbk.js';
      import { Runtime } from './dist/runtime.js';
      import { pdtaView, mlist } from './dist/react-light.js';
      const expect = chai.expect;
      describe('mocha', () => {
        it('it tests stuff', () => {
          chai.expect(true);
        });
      });
      describe('audio', () => {
        it('can init ctx', async () => {
          try {
            const ctx = new AudioContext();
            expect(ctx).to.exist;
            expect(ctx.state).eq('suspended');
            await ctx.audioWorklet.addModule('./dist/rend-proc.js');
            const proc = new AudioWorkletNode(ctx, 'rend-proc');
            expect(proc).to.exist;
          } catch (e) {
            expect.error(e);
          }
        });
      });
      describe('init sfbk', () => {
        it('makes 3 fetch calls with ranges for header,sdta, pdta', async () => {
          const sfbk = await initsfbk('file.sf2');
          expect(sfbk.pdta).to.exist;
        });
      });

      describe('html', () => {
        it('sometimes dangerously set inner html?', async () => {
          document.body.appendChild(mlist);
          const sfbk = await initsfbk('file.sf2');
          debugger;
          document.body.appendChild(pdtaView(sfbk.pdta));
        });
      });
      mocha.run();
    </script>
  </body>
</html>
